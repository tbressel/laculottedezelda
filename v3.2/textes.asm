; ************************************************************************************
; *******************************   TEXTES   ****************************
; ************************************************************************************

;It's dangerous to go alone! take this.

TEXTE_BOUTIQUE_01_ligne1
	DEFM      "  C'EST DANGEREUX D'Y  "
TEXTE_BOUTIQUE_01_ligne2
	DEFM      " ALLER SEUL! PRENDS CA."
TARIF_BOUTIQUE_01
	DEFM      "                       "


;It's dangerous to go alone! take this.
TEXTE_BOUTIQUE_03_ligne1
	DEFM      " TROUVES TODD ! IL SE  "
TEXTE_BOUTIQUE_03_ligne2
	DEFM      "CACHE DANS LES BUISSONS"
TEXTE_BOUTIQUE_03_ligne3
	DEFM      "               "


;It's dangerous to go alone! take this.

TEXTE_BOUTIQUE_07_ligne1
	DEFM      " PRENDS CE QUE TU VEUX "
TEXTE_BOUTIQUE_07_ligne2
	DEFM      "ET BARRE-TOI, CONNARD !"
TARIF_BOUTIQUE_07
	DEFM      "               "


;Buy me somethin', will ya ?
TEXTE_BOUTIQUE_17_ligne1
	DEFM      "  ACHETE-MOI UN TRUC   "
TEXTE_BOUTIQUE_17_ligne2
	DEFM      "        VEUX-TU ?      "
TARIF_BOUTIQUE_17
	DEFM      "x 150   50   60"
	
;
TEXTE_BOUTIQUE_26_ligne1
	DEFM      "C'EST UN SECRET QUE NUL"
TEXTE_BOUTIQUE_26_ligne2
	DEFM      "      NE CONNAIT !     "
TARIF_BOUTIQUE_26
	DEFM      "       100     "


;
TEXTE_BOUTIQUE_72_ligne1
	DEFM      "C'EST UN SECRET QUE NUL"
TEXTE_BOUTIQUE_72_ligne2
	DEFM      "      NE CONNAIT !     "
TARIF_BOUTIQUE_72
	DEFM      "       50      "
	
;
TEXTE_BOUTIQUE_54_ligne1
	DEFM      "C'EST UN SECRET QUE NUL"
TEXTE_BOUTIQUE_54_ligne2
	DEFM      "      NE CONNAIT !     "
TARIF_BOUTIQUE_54
	DEFM      "       30      "
	

	;Buy me somethin', will ya ?
TEXTE_BOUTIQUE_27_ligne1
	DEFM      "  ACHETE-MOI UN TRUC   "
TEXTE_BOUTIQUE_27_ligne2
	DEFM      "        VEUX-TU ?      "
TARIF_BOUTIQUE_27
	DEFM      "x 100   50   60"

;
TEXTE_BOUTIQUE_29_ligne1
	DEFM      " ACHETE UN REMEDE AVANT"
TEXTE_BOUTIQUE_29_ligne2
	DEFM      "       DE PARTIR.      "
TARIF_BOUTIQUE_29
	DEFM      "x  40        68"
	
	
;Pay me and I'll talk ?
TEXTE_BOUTIQUE_36_ligne1
	DEFM      "PAIE MOI ET JE PARLERAI"
TEXTE_BOUTIQUE_36_ligne2
	DEFM      "                       "
TARIF_BOUTIQUE_36
	DEFM      "x -10  -30  -50"
TEXTE_BOUTIQUE_36B_ligne1
	DEFM      "  CE N'EST PAS ASSEZ,  "
TEXTE_BOUTIQUE_36B_ligne2
	DEFM      "     ... RADIN !       "
TARIF_BOUTIQUE_36B
	DEFM      "x -10  -30  -50"	
TEXTE_BOUTIQUE_36C_ligne1
	DEFM      "VA AU NORD, OUEST, SUD "
TEXTE_BOUTIQUE_36C_ligne2
	DEFM      "OUEST... DANS LA FORET."
TARIF_BOUTIQUE_36C
	DEFM      "x -10  -30  -50"	
TEXTE_BOUTIQUE_36D_ligne1
	DEFM      "   HE ! TU ES RICHE !  "
TEXTE_BOUTIQUE_36D_ligne2
	DEFM      "                       "
TARIF_BOUTIQUE_36D
	DEFM      "x -10  -30  -50"		
	

;It's dangerous to go alone! take this.
TEXTE_BOUTIQUE_38_ligne1
	DEFM      " AVEC UNE CLE SPECIALE "
TEXTE_BOUTIQUE_38_ligne2
	DEFM      "TU OUVRIRAS LES DONJONS"
TEXTE_BOUTIQUE_38_ligne3
	DEFM      "               "



;Buy me somethin', will ya ?
TEXTE_BOUTIQUE_50_ligne1
	DEFM      "  ACHETE-MOI UN TRUC   "
TEXTE_BOUTIQUE_50_ligne2
	DEFM      "        VEUX-TU ?      "
TARIF_BOUTIQUE_50 
	DEFM      "x 100   20   80"




;Let's play money making game
TEXTE_BOUTIQUE_86_ligne1
	DEFM      " ET SI ON JOUAIT A DES "
TEXTE_BOUTIQUE_86_ligne2
	DEFM      "     JEUX D'ARGENT ?   "
TARIF_BOUTIQUE_86
	DEFM      "x -10  -10  -10"
	
	TEXTE_BOUTIQUE_86B_ligne1
	DEFM      "    TE VOILA RICHE !   "
TEXTE_BOUTIQUE_86B_ligne2
	DEFM      "   VEUX-TU REJOUER ?   "
TARIF_BOUTIQUE_86B
	DEFM      "x +20  -10  -10"
	
	TEXTE_BOUTIQUE_86C_ligne1
	DEFM      " ON PEUT PAS GAGNER A  "
TEXTE_BOUTIQUE_86C_ligne2
	DEFM      "    TOUS LES COUPS !   "
TARIF_BOUTIQUE_86C
	DEFM      "x -10  -10  -10"
	
	TEXTE_BOUTIQUE_86D_ligne1
	DEFM      "PERDU ... TU RETENTES ?"
TEXTE_BOUTIQUE_86D_ligne2
	DEFM      " ...  JUSTE UNE FOIS ! "
TARIF_BOUTIQUE_86D
	DEFM      "x -10  -10  -10"
	
	
TEXTE_BOUTIQUE_74_ligne1
	DEFM      "       HE! C'EST       "
TEXTE_BOUTIQUE_74_ligne2
	DEFM      "     VRAIMENT DONNE    "
TEXTE_BOUTIQUE_74_ligne3
	DEFM      "x 90    10   60"
	
;Presente ceci a la dame agee
TEXTE_BOUTIQUE_25_ligne1
	DEFM      " PAIE-MOI POUR REPARER "
TEXTE_BOUTIQUE_25_ligne2
	DEFM      "  MA PORTE, SALE CON  !"
TEXTE_BOUTIQUE_25_ligne3
	DEFM      "              "	
	
	
;Presente ceci a la dame agee
TEXTE_BOUTIQUE_76_ligne1
	DEFM      "       HE! C'EST       "
TEXTE_BOUTIQUE_76_ligne2
	DEFM      "     VRAIMENT DONNE    "
TEXTE_BOUTIQUE_76_ligne3
	DEFM      "x 100  150   60"

;Presente ceci a la dame agee
TEXTE_BOUTIQUE_87_ligne1
	DEFM      "   APPORTE CECI A LA   "
TEXTE_BOUTIQUE_87_ligne2
	DEFM      "      VIEILLE DAME     "
TEXTE_BOUTIQUE_87_ligne3
	DEFM      "                       "


;Presente ceci a la dame agee
TEXTE_BOUTIQUE_83_ligne1
	DEFM      "TOUT AU NORD-EST, IL Y "
TEXTE_BOUTIQUE_83_ligne2
	DEFM      "A UN CHEMIN INVISIBLE. "
TEXTE_BOUTIQUE_83_ligne3
	DEFM      "                       "

;Master using it and you can have this.
TEXTE_BOUTIQUE_90_ligne1
	DEFM      "  MAITRISE TON ARME ET "
TEXTE_BOUTIQUE_90_ligne2
	DEFM      "  TU SERAS RECOMPENSE. "
TEXTE_BOUTIQUE_90_ligne3
	DEFM      "                       "
	
;Master using it and you can have this.
TEXTE_BOUTIQUE_05_104_ligne1
	DEFM      " JE PEUX TE TELEPORTER "
TEXTE_BOUTIQUE_05_104_ligne2
	DEFM      "LOINNNNNNN D'ICI, OK ? "
TEXTE_BOUTIQUE_05_104_ligne3
	DEFM      "                       "
	
;Master using it and you can have this.
TEXTE_BOUTIQUE_128_ligne1
	DEFM      " REVIENS ME VOIR QUAND "
TEXTE_BOUTIQUE_128_ligne2
	DEFM      "TU AURAS NIKE LE DRAGON"
TEXTE_BOUTIQUE_128_ligne3
	DEFM      "                       "

	
;Master using it and you can have this.
TEXTE_BOUTIQUE_96_ligne1
	DEFM      "LE MAGASIN DE PABLO EST"
TEXTE_BOUTIQUE_96_ligne2
	DEFM      " A COTE DU RUISSEAU    "
TEXTE_BOUTIQUE_96_ligne3
	DEFM      "A 9 LIEUX D'ICI"
	
	

TEXTE_BOUTIQUE_51_ligne1
	DEFM      "OUINN! PRENDS CA ET LES"
TEXTE_BOUTIQUE_51_ligne2
	DEFM      "EAUX PORTERONT TES PAS!"
TARIF_BOUTIQUE_51
	DEFM      "                       "

TEXTE_BOUTIQUE_103_ligne1
	DEFM      "CET ENDROIT EST MAGIQUE"
TEXTE_BOUTIQUE_103_ligne2
	DEFM      " REVIENS AVEC LE BATON "
TARIF_BOUTIQUE_103
	DEFM      "                       "

TEXTE_BOUTIQUE_109_ligne1
	DEFM      "Comprame un juego tonto"
TEXTE_BOUTIQUE_109_ligne2
	DEFM      "Chase HQ2   o     Pang?"
TARIF_BOUTIQUE_109
	DEFM      "x 255       255"

TEXTE_BOUTIQUE_123_ligne1
	DEFM      "COUCOU MON LINKOUNET ! "
TEXTE_BOUTIQUE_123_ligne2
	DEFM      "MIAM..C'TE GROSSE FLUTE"
TARIF_BOUTIQUE_123
	DEFM      "x 110   20   80"


TEXTE_BOUTIQUE_138_ligne1
	DEFM      " ON M'A VOLE MA BAGUE !"
TEXTE_BOUTIQUE_138_ligne2
	DEFM      "TROUVES-LA ET GARDES-LA"
TARIF_BOUTIQUE_138
	DEFM      "               "	


TEXTE_BOUTIQUE_158_ligne1
	DEFM      "J'AI VU UN POISSON ZORA"
TEXTE_BOUTIQUE_158_ligne2
	DEFM      " AVALER UN TRUC EN OR. "
TARIF_BOUTIQUE_158
	DEFM      "               "	

TEXTE_BOUTIQUE_177_ligne1
	DEFM      "  LA MUSIQUE OUVRE LA  "
TEXTE_BOUTIQUE_177_ligne2
	DEFM      " VOIE DES RIVIERES ET  "
TARIF_BOUTIQUE_177
	DEFM      "  DES OCEANS   "	

TEXTE_BOUTIQUE_198_ligne1
	DEFM      "PETE LA GUEULE A MARIO!"
TEXTE_BOUTIQUE_198_ligne2
	DEFM      " IL S'EST TAPE ZELDA !!"
TARIF_BOUTIQUE_198
	DEFM      "               "	

TEXTE_BOUTIQUE_250_ligne1
	DEFM      " CE BATON EST MAGIQUE, "
TEXTE_BOUTIQUE_250_ligne2
	DEFM      "TU VERRAS DES CHOSES..."
TARIF_BOUTIQUE_250
	DEFM      "                 "	
	
TEXTE_BOUTIQUE_98_ligne1
	DEFM      "TU POURRAIS DECHIRER TA"
TEXTE_BOUTIQUE_98_ligne2
	DEFM      "MERE AVEC CETTE EPEE !!"
TARIF_BOUTIQUE_98
	DEFM      "               "	
; ************************************************************************************
; *******************************   GESTION DE LA FONTE   ****************************
; ************************************************************************************

ROUTINE_TEXTE
	call	asic_off
	call 	c4_on
	ld	HL,(texte_boutique)
	ld	a,(nombre_de_lettre)	
	ld	b,a
	LD 	A,(HL)        ;l'adresse de HL qui contient 1 octet est mis dans A (le numero ASCII de "H" donc #48 en hexa ou 72 en dec)
calcule_lettre
	push 	bc
	Push 	hl
	SUB 	32          ;on soustrait 32 au numero ASCII de la lettre H pour donner sa position dans la fonte (#20 en hexa)
		 ; donc A=#28 (#48-#20)
	LD 	L,A		 ; donc met le resultat dans L
	LD 	H,0           ;on met 0 dans H (car H ne doit pas etre vide)
                 ;HL contient la position de la lettre donc HL= #0028    (40 en decimal)     
		 ;mes lettres font 16 lignes de haut sur 16 pixel de large (donc en mode 1 4 octet de large
		 ;donc 16 * 4 = 64 octets (longueur d'une lettre en RAM)
		 ;donc on multiplie la position de la lettre (40) par la longeur d'une lettre (64)(on doit obtenir 40*64=2560) 
	ADD 	HL,HL        ; 40 + 40 = 80  ca fait x2
	ADD 	HL,HL        ; 80 + 80 = 160  ca fait x4
	ADD 	HL,HL        ; 160 + 160 = 320  ca fait x8
	ADD 	HL,HL        ; 320 + 320 = 640  ca fait x16
							; HL = 2560 soit #0A00  c'est l'adresse de la lettre ->dans la FONTE<- (donc adresse en partant de 0)
	LD 	DE,FONTE_TEXTE      ;on met #4000 dans DE qui correspond a l'adresse de notre fonte ->dans la RAM<-
	ADD 	HL,DE        ;on additionne pour avoir l'adresse de la lettre ->dans la RAM<-
    		 ; donc HL = #4A00
	call	affiche_4_colonnes
	HALT
	HALT
	HALT
	call 	c4_on
	pop 	hl
	inc 	hl
	LD 	A,(HL) 
	
	pop 	bc
	djnz	calcule_lettre
	ret

affiche_4_colonnes
	ld	de,(DEPART_DU_TEXTE)
	push 	de
	CALL 	colonne
	POP 	DE
	INC 	DE
	PUSH 	DE
	CALL 	colonne
	POP 	DE
	INC 	DE
	ld	(DEPART_DU_TEXTE),DE
	RET
colonne
	LD 	B,8		 ; les lettres font 16 lignes sur une longueur BC
boucle_colonne
	PUSH 	BC		 ; ... pour mettre ca dans la pile (registre 16 bits obligatoir)
	LD 	BC,#01	 ; largeur d'une lettre de 4 octets (mode 1, 16 pxl font 4 octets)
	PUSH 	DE		 ; on sauve DE avant que le LDIR le modifie ...
	LDIR		 ; il incremente HL et DE (HL = #4A01   DE = C001 BC = 00)
	POP 	DE		 ; on recupere notre DE de la pile
	CALL 	LIGNEINF_c000	 ; ligne inferieur
	POP 	BC		 ; nouvelle ligne calcule, on recupere notre compteur ...
	DJNZ 	boucle_colonne
	RET	
	
	
	
affiche_texte_ROM
	ld		a,(flag_texte)
	cp		a,0
	jp		z,texte_event_off
	ld		a,(nbr_de_ligne)
	cp		a,3
	jp		z,affiche_texte_ligne1
	cp		a,2
	jp		z,affiche_texte_ligne2
	cp		a,1
	jp		z,affiche_texte_ligne3
	cp		a,0
	jp		z,fin_de_texte
affiche_texte_ligne1
	dec		a
	ld		(nbr_de_ligne),a
	ld		hl,(texte_boutique_ligne1)
	ld		(texte_boutique),hl
	ld		de,(DEPART_DU_TEXTE_1)
	ld		(DEPART_DU_TEXTE),de
	call	routine_texte
	jp		affiche_texte_ROM
affiche_texte_ligne2
	dec		a
	ld		(nbr_de_ligne),a
	ld		hl,(texte_boutique_ligne2)
	ld		(texte_boutique),hl
	ld		de,(DEPART_DU_TEXTE_2)
	ld		(DEPART_DU_TEXTE),de
	call	routine_texte
	jp		affiche_texte_ROM
affiche_texte_ligne3
	dec		a
	ld		(nbr_de_ligne),a
	ld		hl,(texte_boutique_ligne3)
	ld		(texte_boutique),hl
	ld		de,(DEPART_DU_TEXTE_3)
	ld		(DEPART_DU_TEXTE),de
	ld		a,15
	ld		(nombre_de_lettre),a
	call	routine_texte
	jp		affiche_texte_ROM

fin_de_texte
	xor		a
	ld		(flag_texte),a
	call	C4_off
	call	asic_on
	ld		a,(flag_noexit)
	cp		a,2
	jp		z,init_mort_link
	ret
	
texte_event_off
	xor		a
	ld 		(event_texte),a
	ld 		(event_texte+1),a
	ld 		(event_texte+2),a
	ret
	
	